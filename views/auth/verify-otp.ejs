<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifikasi OTP - SIPANDI</title>
    <link rel="stylesheet" href="/css/output.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .otp-input {
            width: 3rem;
            height: 3.5rem;
            text-align: center;
            font-size: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
        }

        .otp-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-sipandi-green-50 to-sipandi-green-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-8">

        <!-- Header / Icon -->
        <div class="text-center mb-6">
            <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                    </path>
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-800">Verifikasi Keamanan</h2>
            <p class="text-gray-500 text-sm mt-3 leading-relaxed">
                Demi keamanan akun Anda, kami telah mengirimkan 6 digit kode rahasia ke email <br>
                <span class="font-semibold text-gray-700 bg-gray-100 px-2 py-0.5 rounded">
                    <%= email %>
                </span>
            </p>
            <p class="text-gray-500 text-xs mt-2">
                Silakan cek kotak masuk atau folder spam Anda, lalu masukkan kode tersebut di bawah ini.
            </p>
        </div>

        <!-- Feedback Messages -->
        <% if (success) { %>
            <div
                class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-6 text-sm text-center">
                <%= success %>
            </div>
            <% } %>
                <% if (error) { %>
                    <div
                        class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 text-sm text-center">
                        <%= error %>
                    </div>
                    <% } %>

                        <form id="otpForm" action="/verify-otp" method="POST" class="space-y-6">
                            <input type="hidden" name="email" value="<%= email %>">
                            <input type="hidden" name="otp" id="finalOtp">

                            <!-- 6 Digit Boxes -->
                            <div class="flex justify-between gap-2 mb-2">
                                <input type="text" maxlength="1" class="otp-input" autofocus
                                    oninput="handleInput(this, 1)" onkeydown="handleBackspace(this, event, 1)">
                                <input type="text" maxlength="1" class="otp-input" oninput="handleInput(this, 2)"
                                    onkeydown="handleBackspace(this, event, 2)">
                                <input type="text" maxlength="1" class="otp-input" oninput="handleInput(this, 3)"
                                    onkeydown="handleBackspace(this, event, 3)">
                                <input type="text" maxlength="1" class="otp-input" oninput="handleInput(this, 4)"
                                    onkeydown="handleBackspace(this, event, 4)">
                                <input type="text" maxlength="1" class="otp-input" oninput="handleInput(this, 5)"
                                    onkeydown="handleBackspace(this, event, 5)">
                                <input type="text" maxlength="1" class="otp-input" oninput="handleInput(this, 6)"
                                    onkeydown="handleBackspace(this, event, 6)">
                            </div>

                            <button type="submit" id="submitBtn" disabled
                                class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition-all shadow-md">
                                Verifikasi Kode
                            </button>
                        </form>

                        <!-- Countdown Timer -->
                        <div class="mt-8 text-center border-t pt-6 border-gray-100">
                            <p class="text-sm text-gray-500 mb-2">Belum menerima kode?</p>

                            <div id="timerSection">
                                <span class="text-sm font-medium text-gray-700">Kirim ulang dalam </span>
                                <span id="countdown" class="text-sm font-bold text-green-600">00:30</span>
                            </div>

                            <div id="resendSection" class="hidden">
                                <form action="/forgot-password" method="POST">
                                    <input type="hidden" name="email" value="<%= email %>">
                                    <button type="submit"
                                        class="text-green-600 hover:text-green-800 font-semibold text-sm hover:underline flex items-center justify-center gap-1 mx-auto">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                            </path>
                                        </svg>
                                        Kirim Ulang Kode
                                    </button>
                                </form>
                            </div>
                        </div>
    </div>

    <script>
        // 1. Logic Input OTP (Pindah-pindah box)
        function handleInput(elm, index) {
            elm.value = elm.value.replace(/[^0-9]/g, ''); // Hanya angka

            if (elm.value.length > 0) {
                if (index < 6) {
                    // Fokus ke box berikutnya
                    document.querySelectorAll('.otp-input')[index].focus();
                }
            }
            checkFullOtp();
        }

        function handleBackspace(elm, event, index) {
            if (event.key === 'Backspace' && elm.value.length === 0) {
                if (index > 1) {
                    // Balik ke box sebelumnya dan hapus isinya
                    const prev = document.querySelectorAll('.otp-input')[index - 2];
                    prev.focus();
                    prev.value = '';
                }
            }
            // Logic tambahan: izinkan paste code (Ctrl+V)
            setTimeout(checkFullOtp, 10);
        }

        // Logic Paste OTP (User copas 123456 langsung ke box pertama)
        document.querySelector('.otp-input').addEventListener('paste', function (e) {
            e.preventDefault();
            const pasteData = (e.clipboardData || window.clipboardData).getData('text').trim();
            if (!/^\d{6}$/.test(pasteData)) return; // Validasi harus 6 digit angka

            const inputs = document.querySelectorAll('.otp-input');
            const digits = pasteData.split('');
            inputs.forEach((input, i) => {
                input.value = digits[i];
            });
            inputs[5].focus(); // Fokus ke box terakhir
            checkFullOtp();
        });

        // Cek apakah semua box terisi untuk enable tombol
        function checkFullOtp() {
            const inputs = document.querySelectorAll('.otp-input');
            let code = '';
            inputs.forEach(input => code += input.value);

            document.getElementById('finalOtp').value = code;

            const btn = document.getElementById('submitBtn');
            if (code.length === 6) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-300', 'cursor-not-allowed');
                btn.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-300', 'cursor-not-allowed');
                btn.classList.remove('bg-green-600', 'hover:bg-green-700');
            }
        }

        // 2. Logic Countdown Timer (30 Detik)
        let timeLeft = 30; // Ubah jadi 30 detik
        const countdownEl = document.getElementById('countdown');
        const timerSection = document.getElementById('timerSection');
        const resendSection = document.getElementById('resendSection');

        const timer = setInterval(() => {
            if (timeLeft <= 0) {
                clearInterval(timer);
                timerSection.classList.add('hidden');
                resendSection.classList.remove('hidden');
            } else {
                const minutes = Math.floor(timeLeft / 60);
                let seconds = timeLeft % 60;
                seconds = seconds < 10 ? '0' + seconds : seconds;
                countdownEl.innerText = `0${minutes}:${seconds}`;
                timeLeft--;
            }
        }, 1000);
    </script>
</body>

</html>